(()=>{"use strict";let e="EN",t="RU",s=e;const n=!!new RegExp("ipad|iphone|android|pocket|palm|windows ce|windowsce|cellphone|opera mobi|ipod|small|sharp|sonyericsson|symbian|opera mini|nokia|htc_|samsung|motorola|smartphone|blackberry|playstation portable|tablet browser|webOS|BB|PlayBook|IEMobile|Windows Phone|Kindle|Silk","i").test(navigator.userAgent),o={data:()=>({vueCurrentUsername:"",vueCheckLichess:!1,vueLichessOrgPlayerNames:"",vueCheckChessCom:!1,vueChessComPlayerNames:"",vueAutoRefreshInterval:"",vueCheckDarkTheme:!1,vueArLichessPlayers:[],vueArChessComPlayers:[],vueArLichessPlayersBuf:[],vueArChessComPlayersBuf:[]}),methods:{vueScoreLichess(e){!function(e){!async function(e,t){if(-1===e.indexOf(t))return;Oe(true,!0);const s=De();let n=!1,o="";const r=Math.max.apply(null,e.map((e=>e.length)));for(let a of e)if(a!==t){const e=`${i}${t}/${a}`;try{const a=await fetch(e);if(a.ok){const e=await a.json();if(e&&!e.error){let n="",a=0,l="",i=0;const c=e.users;for(let e in c)e.toUpperCase()===t.toUpperCase()?(n=e,a=c[e]):(l=e,i=c[e]);const u=a-i;let m=(u>0?"+":"")+`${u}`;0===u||s||(m=`<span class="${u>0?"scorePlus":"scoreMinus"}">${m}</span>`);const d="_".repeat(r-l.length+2);o+=s?`X - ${l} ${d} ${a} : ${i} = ${m}\n`:`${n} - ${l} ${d}   ${a} : ${i} = ${m}\n`}}else n=!0,Ee(`status error: ${a.status} ${a.statusText} - ${e}`)}catch(t){n=!0,Ee(`error: ${t} - ${e}`)}}o+=n?'\nLichess says: "Too many requests from your ip-address."\nTry again later.':"",Oe(true,!1),function(e="",t=""){De()?alert((t?t+"\n\n":"")+e):(document.getElementById("modalDialogHead").innerHTML=He(t,"\n","<br>"),document.getElementById("modalDialogText").innerHTML=He(e,"\n","<br>"),z.showModal())}(o,s?`Score (X is ${t} ):`:"Score between players:")}(le(!0),e)}(e)},vueGroupAdd(){!function(){let e;if(10===X().length)return void alert("10 groups have already been created.\n\nThis is maximum !");const t=prompt("Input name of new group:","");null!==t&&""!==t&&(t.length>30?alert("The name must not exceed 30 symbols !"):(e=t.toUpperCase(),void 0===v.find((t=>t.name.toUpperCase()===e))?t.includes("!")?alert('The name must not include symbol "!".'):(v.push({name:t,lichessPlayerNames:a.vueLichessOrgPlayerNames,chessComPlayerNames:a.vueChessComPlayerNames}),T=t,U(document.getElementById("group"),T,T),Se(),alert(`It's created group "${t}"\nwith the current lists of players.\n\nChange player lists !`)):alert(`Group "${t}" already exists.\n\nPlease enter an another name !`)))}()},vueGroupDel(){!function(){let e=T;const t=L.indexOf(e,0);if(_(t))return void alert(`Group "${e}" cannot be deleted !`);if(!confirm(`Delete group "${e}" ?`))return;const s=document.getElementById("group");s.options[t]=null,s.options[0].selected=!0,v=v.filter(((e,s,n)=>s!==t)),L=X(),T=L[0],Ae(v[0].lichessPlayerNames),ke(v[0].chessComPlayerNames),se(),alert(`Group "${e}" is deleted.\n\nCurrent group is "${T}" !`)}()},vueGroupRestore(){!function(){let e=T;const t=L.indexOf(e,0);_(t)?confirm(`Restore group "${e}" ?`)&&(v[t]=S[t],T=v[t].name,L=X(),F(T),Ae(S[t].lichessPlayerNames),ke(S[t].chessComPlayerNames),se(),alert(`Group "${e}" will be restored !`)):alert(`Group "${e}" cannot be restored !`)}()},vueGoUserMode(){!function(){document.querySelector("#errorMessage").textContent="",document.querySelector("#okMessage").textContent="",Ce("main"),ye(".sectionLoginArea");let e=localStorage.getItem("regtype");if(e=e||"","github"===R||"google"===R||"lichess"===R||"github"===e||"google"===e||"lichess"===e)document.getElementById("username").value="",document.getElementById("password").value="";else{const e=localStorage.getItem("username");document.getElementById("username").value=e||""}!function(){const e=a.vueCurrentUsername;return O&&-1===e.indexOf(u)}()?(document.getElementById("username").removeAttribute("disabled"),document.getElementById("password").removeAttribute("disabled"),Ce("#buttonPostLogout"),ye("#buttonPostLogin"),ye("#buttonPostRegistration"),ye(".referToLichess")):(document.getElementById("username").setAttribute("disabled",!0),document.getElementById("password").setAttribute("disabled",!0),ye("#buttonPostLogout"),Ce("#buttonPostLogin"),Ce("#buttonPostRegistration"),Ce(".referToLichess"))}()},vueRefresh(){se()},vueOnClickCheckLichess(){Be(!qe()),ne()},vueOnClickCheckChessCom(){$e(!xe()),oe()},vueRefreshLichess(){ne()},vueRefreshChessCom(){oe()},vueOnchangeLichessPlayerNames(){!function(){let e=Le();e=void 0===e?"":e,Ae(e),J()}()},vueOnchangeChessComPlayerNames(){!function(){let e=Pe();e=void 0===e?"":e,ke(e),J()}()},vueGoSetMode(){Ce("main"),ye(".sectionSettingsArea")},vueSortBulletLichess(){Z(!0,"bullet")},vueSortBlitzLichess(){Z(!0,"blitz")},vueSortRapidLichess(){Z(!0,"rapid")},vueSortPuzzleLichess(){Z(!0,"puzzle")},vueSortRushLichess(){Z(!0,"rush")},vueSortBulletChessCom(){Z(!1,"bullet")},vueSortBlitzChessCom(){Z(!1,"blitz")},vueSortRapidChessCom(){Z(!1,"rapid")},vueSortPuzzleChessCom(){Z(!1,"puzzle")},vueSortRushChessCom(){Z(!1,"rush")},vueOnchangeAutoRefreshInterval(){!function(){let e=Ie();e=void 0===e?"":e,we(e.trim())}()},vueOnClickSetTheme(){Te(!Ne()),Se(),Me()},vueClearSettings(){confirm("All settings will be cleared.\n\nAre you sure ?")&&(localStorage.clear(),we(""),Te(!1),E(),H(T),Ae(v[0].lichessPlayerNames),ke(v[0].chessComPlayerNames),function(){let e=document.getElementById("group").options;for(;e.length>b;)e[e.length-1]=null}(),q&&(q=!1,ve()),se(),be(),Me(),alert("All settings are cleared."))},vueRestoreStartGroups(){confirm("All Start-groups will be restored.\n\nAre you sure ?")&&(D(),function(){const e=document.getElementById("group");for(let t=0;t<b;t++)j(e,t,L[t],T)}(),se(),alert("All Start-groups are restored."),fe())},vueGoMainModeFromSettings(){fe()},vueButtonChangeTables(){ve(),function(){q=!q;const e=q?"1":"";localStorage.setItem("isFirstChessCom",e)}()},vueGoMainModeFromUser(){pe()}}},r=Vue.createApp(o);r.component("vue-component-tips",{template:'\n    <fieldset id="tipsEN" class="showBlock">\n    <legend><em><strong>Tips</strong></em></legend>\n    <ul>\n      <li><span class="click">Click</span> on the <span class="dotted">text "Player ratings/score"</span>\n        to refresh all tables\n      </li>\n      <li><span class="click">Click</span> on the <span class="dotted">heading "Lichess"</span> to refresh the\n        Lichess table and sort by player list</li>\n      <li><span class="click">Click</span> on the <span class="dotted">heading "Chess.com"</span> to refresh the\n        Chess.com table and sort by player list</li>\n      <li><span class="click">Click</span> on <span class="dotted">any other heading</span> to sort by rating\n      </li>\n      <li><span class="click">Click</span> on the <span class="dotted">"↑↓" button</span> to change the order of\n        tables</li>\n      <li>For Lichess there are several types of <span class="dotted">player status</span> to the left of his\n        name in table:\n        <ul>\n          <li><span class="statusOnline">&#10004;</span> - online</li>\n          <li><span class="statusPlaying">&#9679;</span> - playing</li>\n          <li><span class="statusStreaming">&#127908;</span> - streaming</li>\n        </ul>\n      </li>\n      <li>\n        If you <span class="click">hover the mouse over </span><span class="dotted">the player in table</span>,\n        a pop-up window will appear with an <span class="dotted">information about player</span>\n      </li>\n      <li>\n        Green and red values in the rating table - are a change in the <span class="dotted">rating of the last\n          game day</span> in comparison with the <span class="dotted">rating of the previous game day</span>.\n      </li>\n    </ul>\n    </fieldset>\n\n    <fieldset id="tipsRU" class="hiddenBlock">\n    <legend><em><strong>Подсказки</strong></em></legend>\n    <ul>\n      <li><span class="click">Кликните</span> на <span class="dotted">тексте "Рейтинги / счет игрока" </span>\n        для обновления всех таблиц</li>\n      <li><span class="click">Кликните</span> на <span class="dotted">заголовке "Lichess" </span>\n        для обновления таблицы Lichess и упорядочивания ее по списку игроков</li>\n      <li><span class="click">Кликните</span> на <span class="dotted">заголовке "Chess.com" </span>\n        для обновления таблицы Chess.com и упорядочивания ее по списку игроков</li>\n      <li><span class="click">Кликните</span> на <span class="dotted">на других заголовках </span>\n        для упорядочивания таблицы по соответствующему рейтингу</li>\n      <li><span class="click">Кликните</span> на <span class="dotted">кнопке "↑↓"</span>, чтобы поменять порядок таблиц</li>\n      <li>Для Lichess отображаются несколько типов <span class="dotted">статусов игрока</span> слева от его имени в таблице:\n        <ul>\n          <li><span class="statusOnline">&#10004;</span> - онлайн</li>\n          <li><span class="statusPlaying">&#9679;</span> - сейчас играет</li>\n          <li><span class="statusStreaming">&#127908;</span> - сейчас стримит</li>\n        </ul>\n      </li>\n      <li>\n        <span class="click">При наведении</span> курсора мыши над <span class="dotted">именем игрока в таблице</span>,\n        появится подсказка с <span class="dotted">информацией об игроке из его профиля</span>\n      </li>\n      <li>\n        Зеленые и красные значения в таблице рейтингов - это изменение <span class="dotted">\n          рейтинга последнего игрового дня</span> в сравнении с <span class="dotted">рейтингом предыдущего игрового дня</span>.\n      </li>\n    </ul>\n    </fieldset>\n'});const a=r.mount("#vue-mount"),l="https://lichess.org/api/user/",i="https://lichess.org/api/crosstable/",c="cors",u="  (disconnected)",m="@FIDE@",d="@STATUS-TEXT@",h="@STATUS-SYMBOL@",g=new Map([["player",0],["bullet",1],["blitz",2],["rapid",3],["puzzle",4],["rush",5]]),p="bovgit",f="Creator of this page :)",y=new Map([[p,f],["Thibault","Creator of Lichess.org"],["DrNykterstein","World champion\n\nMagnus Carlsen, Norway, FIDE 2882, GM"],["AvalonGamemaster","? Maxime Vachier-Lagrave, France, GM"]]),C=new Map([[p,f],["Erik","Creator of Chess.com"],["MagnusCarlsen","World champion"]]),S=[{name:"! FIDE top",lichessPlayerNames:"DrNykterstein Alireza2003 Bombegranate AnishGiri AvalonGamemaster",chessComPlayerNames:"MagnusCarlsen Firouzja2003 ChefsHouse FabianoCaruana LevonAronian LachesisQ AnishGiri Grischuk gmwso LyonBeast"},{name:"! custom",lichessPlayerNames:"Thibault Zhigalko_Sergei Benefactorr Chess-Network Crest64 Challenger_Spy ShahMatKanal Shuvalov Pandochka",chessComPlayerNames:"Erik Hikaru ChessQueen ChessNetwork ShahMatKanal"}],b=S.length;let v,L,A,P,k,I,w,N,T=S[0].name,q=!1,B="",x="",$="",M="",O="",R="";k=document.querySelector("#InputOrder1"),I=document.querySelector("#InputOrder2"),w=document.querySelector("#LichessTables"),N=document.querySelector("#ChessComTables"),n&&(document.querySelector("#bodyStyle").setAttribute("class","mobileStyle"),document.querySelector("#projectName").setAttribute("class","projectName projectNameDifMobile"),document.querySelector("#modalDialog").setAttribute("class","modalDialogMobileStyle"));const z=document.getElementById("modalDialog");function E(){v=[];for(let e=0;e<b;e++)v.push("");D()}function D(){for(let e=0;e<b;e++)v[e]=JSON.parse(JSON.stringify(S[e]));T=v[0].name,L=X(),Ae(v[0].lichessPlayerNames),ke(v[0].chessComPlayerNames)}function H(e){const t=document.getElementById("group");for(let s=0;s<L.length;s++)U(t,L[s],e)}function U(e,t,s){const n=document.createElement("option");G(n,t,s),e.appendChild(n)}function G(e,t,s){e.value=t,e.innerHTML="<strong><em>"+t+"</em></strong>",e.value===s&&(e.selected=!0)}function j(e,t,s,n){G(e[t],s,n)}function F(e){j(document.getElementById("group"),L.indexOf(e,0),e,e)}function J(){const e=v.find((e=>e.name===T));e.lichessPlayerNames=a.vueLichessOrgPlayerNames,e.chessComPlayerNames=a.vueChessComPlayerNames}function X(){return v.map((e=>e.name))}function _(e){return e>-1&&e<b}async function W(){const e=V();if(!e)return;K("User login...");const t=await fetch("/loginAJAX",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"},body:e});if(t.ok){const e=await t.json();if(Ee("jsonObj: "+new Date),Ee(e),e.errorMsg){const t=e.errorMsg.message;return void Y(t?`Login error: ${t}`:"Login unknown error")}let s,n,o,r,a,l,i,c;return K("User logged in."),s=e.usernameAfterLogin,s&&(n=e.regtypeAfterLogin,Q(s,n),localStorage.setItem("username",O),localStorage.setItem("regtype",R),n=e.LichessOrgPlayerNamesAfterLogin,n&&(Ae(n),localStorage.setItem("LichessOrgPlayerNames",n)),o=e.ChessComPlayerNamesAfterLogin,o&&(ke(o),localStorage.setItem("ChessComPlayerNames",o)),r=!1,s=e.isDarkThemeAfterLogin,s&&(r="1"===s,Te(r),localStorage.setItem("DarkThemeChecked",r?"1":"0"),Me()),a=!1,s=e.CheckLichessAfterLogin,s&&(a="1"===s,Be(a),localStorage.setItem("LichessChecked",a?"1":"0")),l=!1,s=e.CheckChessComAfterLogin,s&&(l="1"===s,$e(l),localStorage.setItem("ChessComChecked",l?"1":"0")),i=!1,s=e.isFirstChessComAfterLogin,s&&(i="1"===s,i!==q&&(q=i,ve()),localStorage.setItem("isFirstChessCom",i?"1":"0")),c=e.autoRefreshIntervalAfterLogin,c&&(we(c),localStorage.setItem("AutoRefreshInterval",c)),(n||o||r||a||l||i)&&se()),void pe()}Y("Error occured during login.")}function V(){let e;if(e=document.querySelector("#username").value.trim(),!e)return alert("Fill username !"),"";if("anonym"===e.toLowerCase())return alert("This username is unacceptable !"),"";if(e.indexOf(" ")>=0)return alert("Username should not contain a space !"),"";let t=e;if(e=document.querySelector("#password").value,!e)return alert("Fill password !"),"";if(e.indexOf(" ")>=0)return alert("Password should not contain a space !"),"";let s=e;return"username="+encodeURIComponent(t)+"&password="+encodeURIComponent(s)}function Y(e){document.querySelector("#errorMessage").textContent=e,document.querySelector("#okMessage").textContent=""}function K(e){document.querySelector("#errorMessage").textContent="",document.querySelector("#okMessage").textContent=e}function Q(e,t){O=e||"",R=t||"",R="userpass"===R?"":R,a.vueCurrentUsername=O}function Z(e,t){if(""===t)return;let s,n,o,r,l,i,c,u,m=function(e){const t=e?".TBodyLichess":".TBodyChessCom";return document.querySelector(t)}(e),d=m.rows.length;if(0===d)return;let h=new Array(d);for(s=0;s<d;s++)for(r=m.rows[s].cells,o=r.length,h[s]=new Array(o),n=0;n<o;n++)l=0===n?e?a.vueArLichessPlayers[s].playerName:a.vueArChessComPlayers[s].playerName:r[n].textContent,l=l.trim(),0===n?h[s][n]=l:(i=0,""!==l&&(i=parseInt(l,10),!isNaN(i)&&Number.isInteger(i)||(i=0)),h[s][n]=i);h.sort((function(e,s){let n=g.get(t);return s[n]-e[n]})),ee(e),c=".THead"+t+(e?"Lichess":"ChessCom"),l=document.querySelector(c).textContent,u=l.slice(-1),"↑"!==u&&(document.querySelector(c).textContent+="↑"),e?(B=c,$=t):(x=c,M=t);const p=[];let f,y;for(s=0;s<d;s++)for(f=0;f<d;f++)if(y=e?a.vueArLichessPlayers[f].playerName:a.vueArChessComPlayers[f].playerName,h[s][0]===y){p.push(e?a.vueArLichessPlayers[f]:a.vueArChessComPlayers[f]);break}for(s=0;s<d;s++)e?a.vueArLichessPlayers[s]=p[s]:a.vueArChessComPlayers[s]=p[s]}function ee(e){let t=e?B:x;if(""!==t){let e=document.querySelector(t).textContent;"↑"===e.slice(-1)&&(document.querySelector(t).textContent=e.slice(0,-1))}}function te(e){ee(e),e?(B="",$=""):(x="",M="")}function se(){let e=!0;te(e),ae(e),e=!1,te(e),ae(e),Se()}function ne(){re(!0)}function oe(){re(!1)}function re(e){te(e),ae(e),Se()}function ae(e){const t=e?"#LichessTables":".TableChessComRatings",s=document.querySelector(t);!function(e){return e?qe():xe()}(e)?"none"!==s.style.display&&(s.style.display="none"):("block"!==s.style.display&&(s.style.display="block"),async function(e){let t=le(e);0!==t.length&&(Oe(e,!0),e?(a.vueArLichessPlayersBuf.length=0,await async function(e){await async function(e){const t=e.join(","),s=await fetch("https://lichess.org/api/users",{method:"POST",headers:{"Content-Type":"text/plain; charset=utf-8"},body:t});if(!s.ok)return void Ee(`status error: ${s.status} ${s.statusText} - getProfilesAfterFetchFromLichess`);const n=ze(),o=await s.json();e.forEach(((e,t)=>{const s=e.toUpperCase(),r=o.find((e=>e.username.toUpperCase()===s));if(r){let t,s=de(0,r,"title");s=void 0===s?"":s+" ";let o="",l=y.get(e);l&&(o=l+"\n\n");const i=he(0,r,"profile","firstName"),c=he(0,r,"profile","lastName"),u=he(0,r,"profile","location"),m=he(0,r,"profile","fideRating"),h=he(0,r,"profile","bio"),g=he(0,r,"profile","links");let p="";t=de(0,r,"createdAt"),t&&(p=new Date(t).getFullYear());let f="";t=de(0,r,"seenAt");let C="lastOnline";t&&(f=Re(t),new Date(t)<n&&(C="lastOnlineBeforeToday"));const S=(i?i+" ":"")+(c||"")+(u?(i||c?", ":"")+u:"")+(m?", FIDE "+m:"")+(s&&!l?", "+s:"");o+=S+(S?"\n":"")+(p?"reg. "+p:"")+(f?"\nlast online "+f:"")+"\n"+d+(h?"\n"+He(h,'"',"'"):"")+(g?"\n"+g:"");let b='<a href="https://lichess.org/@/'+e+'" target="_blank" title="'+o+'">@STATUS-SYMBOL@<span class="playerTitle">'+s+" </span><strong>"+e+"</strong></a>"+(f?'<br><span class="'+C+'">'+f+"</span>":"");const v=ge(0,r,"perfs","bullet","rating"),L=ge(0,r,"perfs","blitz","rating"),A=ge(0,r,"perfs","rapid","rating"),P=ge(0,r,"perfs","puzzle","rating"),k=ge(0,r,"perfs","storm","score");a.vueArLichessPlayersBuf.push({playerHTML:b,playerName:e,bullet:v,blitz:L,rapid:A,puzzle:P,rush:k})}else Ee(`${e} - lichess, response.json error`),a.vueArLichessPlayersBuf.push({playerHTML:"<em>"+e+"</em>",playerName:e,bullet:"",blitz:"",rapid:"",puzzle:"",rush:""})}))}(e),await async function(e){(await async function(e){let t=[];const s=e.join(",");let n=fetch(`https://lichess.org/api/users/status?ids=${s}`,{mode:c}).then((e=>200!=e.status?null:e.json()),(e=>null));return t.push(n),await Promise.all(t)}(e))[0].forEach((t=>{const s=t.name;e.forEach(((e,n)=>{if(s.toUpperCase()===e.toUpperCase()){const e=de(0,t,"patron"),s=de(0,t,"online"),o=de(0,t,"playing"),r=de(0,t,"streaming");let l=e?"Patron. ":"";l+=s||r||o?"Now: ":"",l+=o?"playing, ":"",l+=r?"streaming, ":"",l+=!s||r||o?"":"online, ",l=l.trim(),","===l[l.length-1]&&(l=l.slice(0,l.length-1)+".");let i=l?l+"\n":"",c=a.vueArLichessPlayersBuf[n].playerHTML.replace(d,i);l="",r&&(l='<span class="statusStreaming">&#127908;</span>'),o&&(l+='<span class="statusPlaying">&#9679;</span>'),!s||r||o||(l='<span class="statusOnline">&#10004;</span>'),c=c.replace(h,l),a.vueArLichessPlayersBuf[n].playerHTML=c}}))}))}(e),await async function(e){(await async function(e){let t=[];for(let s of e){let e=fetch(`${l}${s}/activity`,{mode:c}).then((e=>200!=e.status?null:e.json()),(e=>null));t.push(e)}return await Promise.all(t)}(e)).forEach(((e,t)=>{if(e&&0!==e.length)for(let s of["bullet","blitz","rapid","puzzle"]){const o="bullet"===s||"blitz"===s||"rapid"===s,r=o?"games":"puzzles",l=o?s:"score",i="rp",c=e.find((e=>!!(e[r]&&e[r][l]&&e[r][l][i])));if(c){const e=c[r][l][i].after,o=c[r][l][i].before;if(e&&o){const r=e-o;if(0!==r){const e=n?"mobileRatingPlus":"ratingPlus";let o=(r>0?"+":"")+`${r}`;o=r>0?"<sup>"+o+"</sup>":"<sub>"+o+"</sub>",o=`<span class="${r>0?e:"ratingMinus"}">${o}</span>`;const l=a.vueArLichessPlayersBuf[t];l[s]=`${l[s]}${o}`,a.vueArLichessPlayersBuf[t]=l}}}}}))}(e),function(e){e.forEach(((e,t)=>{let s=a.vueArLichessPlayersBuf[t].playerHTML.replace(d,"");s=s.replace(h,""),a.vueArLichessPlayersBuf[t].playerHTML=s}))}(e)}(t)):(a.vueArChessComPlayersBuf.length=0,a.vueArChessComPlayersBuf=a.vueArChessComPlayersBuf.map(((e,t)=>{a.vueArChessComPlayersBuf[t]={playerHTML:"",playerName:"",bullet:"",blitz:"",rapid:"",puzzle:"",rush:""}})),await async function(e){let t=!0;await ie(e,t),t=!1,await ie(e,t)}(t)),function(e,t){if(0===t.length)return;const s=e?a.vueArLichessPlayersBuf.length:a.vueArChessComPlayersBuf.length,n=[];for(let o=0;o<t.length;o++){const r=t[o];if(""!==r)for(let t=0;t<s;t++)if(r===(e?a.vueArLichessPlayersBuf[t].playerName:a.vueArChessComPlayersBuf[t].playerName)){n.push(e?a.vueArLichessPlayersBuf[t]:a.vueArChessComPlayersBuf[t]);break}}e?a.vueArLichessPlayers=[...n]:a.vueArChessComPlayers=[...n]}(e,t),Oe(e,!1))}(e))}function le(e){let t=function(e){return e?Le():Pe()}(e),s=t.split(" ");return s=s.filter((e=>""!==e)),s}async function ie(e,t){let s=[...e];const n=s.length;if(0===n)return;const o=t?"profile":"statistics";let r=200;for(let a=0;a<6;a++){let l=[...s];l=l.map((e=>!1)),a>0&&(r+=100,Ee(`step ${a+1} / 6, chess.com ${o}, ${s.length} el. from ${n}, delay ${r}`),await new Promise(((e,t)=>setTimeout(e,r))));let i=!0;const c=t?"":"/stats";if((await ce(!1,s,c)).forEach(((n,r)=>{const a=s[r];let c=!1;t?c=ue(n,a,e):null!==n&&(me(n,e.indexOf(a),a),c=!0),c?l[r]=!0:(i=!1,Ee(`not read ${o}: ${a}, chess.com`))})),i)break;s=s.filter(((e,t)=>!l[t]))}}async function ce(e,t,s=""){let n=[];for(let o of t)if(""!==o){let t=fetch(`${e?l:"https://api.chess.com/pub/player/"}${o}${s}`,{mode:c}).then((e=>200!=e.status?null:e.json()),(e=>null));n.push(t)}return await Promise.all(n)}function ue(e,t,s){let n=!1,o="",r="",l="",i="",c="",u="";const d=ze();let h=C.get(t);if(h&&(u=h+"\n\n"),o=de(0,e,"url"),""===o||null==o)l="<em>"+t+"</em>";else{h=de(0,e,"title"),r=void 0===h?"":h+" ";const s=de(0,e,"name"),a=de(0,e,"location");h=de(0,e,"joined"),h&&(i=new Date(1e3*h).getFullYear()),h=de(0,e,"last_online");let g="lastOnline";h&&(c=Re(1e3*h),new Date(1e3*h)<d&&(g="lastOnlineBeforeToday")),u+=(s||"")+(a?", "+a:""),u+=m+(r?", "+r:""),u+=(u&&u!==m?"\n":"")+"reg. "+i+"\nlast online "+c,l='<a href="'+o+'" target="_blank" title="'+u+'"><span class="playerTitle">'+r+" </span><strong>"+t+"</strong></a>"+(c?'<br><span class="'+g+'">'+c+"</span>":""),n=!0}return s.forEach(((e,s)=>{e===t&&(a.vueArChessComPlayersBuf[s]={playerHTML:l,playerName:t,bullet:"",blitz:"",rapid:"",puzzle:"",rush:""})})),n}function me(e,t,s){const n=de(0,e,"fide"),o=n?`, FIDE ${n}`:"",r=a.vueArChessComPlayersBuf[t].playerHTML.replace(m,o),l=ge(0,e,"chess_bullet","last","rating"),i=ge(0,e,"chess_blitz","last","rating"),c=ge(0,e,"chess_rapid","last","rating"),u=ge(0,e,"tactics","highest","rating"),d=ge(0,e,"puzzle_rush","best","score");a.vueArChessComPlayersBuf[t]={playerHTML:r,playerName:s,bullet:l,blitz:i,rapid:c,puzzle:u,rush:d}}function de(e,t,s){let n="";try{n=t[s]}catch(e){}return n}function he(e,t,s,n){let o="";try{o=t[s][n]}catch(e){}return o}function ge(e,t,s,n,o){let r="";try{r=t[s][n][o]}catch(e){}return r}function pe(){Ce(".sectionLoginArea"),ye("main")}function fe(){let e=Ie();if(""!==e){let t=parseInt(e,10);if(isNaN(t)||!(Number.isInteger(t)&&t>=0&&t<=9999))return void alert("Interval must be between 0 and 9999 !");e=t.toString(10)}we(e),localStorage.setItem("AutoRefreshInterval",e),be(),Ce(".sectionSettingsArea"),ye("main")}function ye(e){document.querySelector(e).style.display="block"}function Ce(e){document.querySelector(e).style.display="none"}function Se(){let e,t,s;localStorage.setItem("groupObjs",JSON.stringify(v)),localStorage.setItem("currentGroupName",T),e=Le(),s=localStorage.getItem("LichessOrgPlayerNames"),s=null===s?"":s,t=e.trim()!==s.trim(),localStorage.setItem("LichessOrgPlayerNames",e),e=Pe(),s=localStorage.getItem("ChessComPlayerNames"),s=null===s?"":s,t=t||e.trim()!==s.trim(),localStorage.setItem("ChessComPlayerNames",e),e=qe()?"1":"0",t=t||e!==localStorage.getItem("LichessChecked"),localStorage.setItem("LichessChecked",e),e=xe()?"1":"0",t=t||e!==localStorage.getItem("ChessComChecked"),localStorage.setItem("ChessComChecked",e),e=Ne()?"1":"0",t=t||e!==localStorage.getItem("DarkThemeChecked"),localStorage.setItem("DarkThemeChecked",e)}function be(){clearInterval(A);let e=Ie();if(""!==e){let t=parseInt(e,10);0!==t&&(A=setInterval(se,60*t*1e3))}else A=void 0}function ve(){let e;I.parentNode.insertBefore(I,k),e=k,k=I,I=e,N.parentNode.insertBefore(N,w),e=w,w=N,N=e}function Le(){return a.vueLichessOrgPlayerNames.trim()}function Ae(e){a.vueLichessOrgPlayerNames=e.trim()}function Pe(){return a.vueChessComPlayerNames.trim()}function ke(e){a.vueChessComPlayerNames=e.trim()}function Ie(){return a.vueAutoRefreshInterval.trim()}function we(e){a.vueAutoRefreshInterval=e?e.trim():""}function Ne(){return a.vueCheckDarkTheme}function Te(e){a.vueCheckDarkTheme=e}function qe(){return a.vueCheckLichess}function Be(e){a.vueCheckLichess=e}function xe(){return a.vueCheckChessCom}function $e(e){a.vueCheckChessCom=e}function Me(){const e=Ne(),t="black",s="white";e?(document.body.style.backgroundColor=t,document.body.style.color=s):(document.body.style.backgroundColor=s,document.body.style.color=t);const n=e?"1":"0";localStorage.setItem("DarkThemeChecked",n)}function Oe(e,t){const s=e?"#LichessWait":"#ChessComWait";let n;e&&qe()&&(n=document.querySelector("#elemTextLichessOrgPlayerNames")),!e&&xe()&&(n=document.querySelector("#elemTextChessComPlayerNames")),n&&(t?(document.querySelector(s).setAttribute("class","showBlock"),n.style.backgroundColor="#ffe4b5",n.setAttribute("class","inputText waitAnimation")):(n.style.backgroundColor="white",n.setAttribute("class","inputText waitAnimation2"),document.querySelector(s).setAttribute("class","hiddenBlock")),document.querySelector("#msgHintEdit").setAttribute("class","msgHint msgHintWaitAnimation"),document.querySelector("#msgHintScore").setAttribute("class","msgHint msgHintWaitAnimation"))}function Re(e){let t=new Date;const s=new Date(t).setHours(0,0,0,0);t-=864e5;const n=new Date(t).setHours(0,0,0,0),o=new Date(e);let r=o.toLocaleString();return r=r.slice(0,-3),o>=s?r=(Ue()?"сегодня":"today")+r.slice(10,17):o>=n&&(r=(Ue()?"вчера":"yesterday")+r.slice(10,17)),r}function ze(){const e=new Date-864e5;return new Date(e).setHours(0,0,0,0)}function Ee(e){const t=(new Date).toLocaleString();console.log(`${t} - ${e}`)}function De(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function He(e,t,s){return e.replace(new RegExp(t,"g"),s)}function Ue(){return s===t}function Ge(){let n;!function(){const n=document.getElementById("langSelect"),o=n.selectedIndex;s=-1===o||n.options[o].text===e?e:t}(),localStorage.setItem("Lang",s);const o=!Ue();document.querySelector("#projectName").textContent=o?"Player ratings / score":"Рейтинги / счет игрока",document.querySelector("#projectName").title=o?"Refresh all tables":"Обновить все таблицы",document.querySelector("#GroupText").textContent=o?"Group:":"Группа:",document.querySelector("#buttonGroupAdd").value=o?"add":" + ",document.querySelector("#buttonGroupAdd").title=o?"Add group":"Добавить группу",document.querySelector("#buttonGroupRestore").value=o?"restore":"↻",document.querySelector("#buttonGroupRestore").title=o?"Restore group":"Восстановить группу",document.querySelector("#buttonGroupDel").value=o?"del":" - ",document.querySelector("#buttonGroupDel").title=o?"Delete group":"Удалить группу",document.querySelector("#elemCheckLichess").title=o?"Make visible or unvisible Lichess table":"Сделать видимой или невидимой таблицу Lichess",document.querySelector("#buttonLichessRefresh").title=o?"Refresh Lichess table":"Обновить таблицу Lichess",n=document.querySelector("#elemTextLichessOrgPlayerNames"),n.title=n.placeholder=o?"Enter names of players on Lichess, separated by spaces":"Введите имена игроков Lichess, разделенные пробелами",document.querySelector("#elemCheckChessCom").title=o?"Make visible or unvisible Chess.com table":"Сделать видимой или невидимой таблицу Chess.com",document.querySelector("#buttonChessComRefresh").title=o?"Refresh Chess.com table":"Обновить таблицу Chess.com",n=document.querySelector("#elemTextChessComPlayerNames"),n.title=n.placeholder=o?"Enter names of players on Chess.com, separated by spaces":"Введите имена игроков Chess.com, разделенные пробелами",document.querySelector("#msgHintEdit").textContent=o?"You can edit player lists !":"Вы можете редактировать списки игроков !",document.querySelector("#msgHintScore").textContent=o?"Click on the rating to see the score !":"Кликните по рейтингу для просмотра счета !",document.querySelector(".THeadbulletLichess").textContent=o?"bullet":"пуля",document.querySelector(".THeadblitzLichess").textContent=o?"blitz":"блиц",document.querySelector(".THeadrapidLichess").textContent=o?"rapid":"рапид",document.querySelector(".THeadpuzzleLichess").textContent=o?"puzzle":"задачи",document.querySelector(".THeadrushLichess").textContent=o?"storm":"штурм",document.querySelector(".THeadbulletChessCom").textContent=o?"bullet":"пуля",document.querySelector(".THeadblitzChessCom").textContent=o?"blitz":"блиц",document.querySelector(".THeadrapidChessCom").textContent=o?"rapid":"рапид",document.querySelector(".THeadpuzzleChessCom").textContent=o?"puzzle":"задачи",document.querySelector(".THeadrushChessCom").textContent=o?"rush":"штурм",document.querySelector("#buttonSettings").value=o?"Settings":"Настройки",document.querySelector("#buttonSettings").title=o?"Settings":"Настройки и подсказки",document.querySelector("#buttonChangeTables").title=o?"Change tables order":"Поменять порядок таблиц",document.querySelector("#legendSettings").textContent=o?"Settings":"Настройки",document.querySelector("#AutoRefresh").textContent=o?"AutoRefresh Interval in minutes (0 - no AutoRefresh): ":"Интервал автообновления в минутах (0 - нет автообновления): ",document.querySelector("#DarkThemeText").textContent=o?"Dark theme":"Темная тема",n=document.querySelector("#buttonClearSettings"),n.value=n.title=o?"Clear all settings, player lists, non-start groups":"Очистить все настройки, списки игроков, не-стартовые группы",n=document.querySelector("#buttonRestoreStartGroups"),n.value=n.title=o?"Restore all start-groups":"Восстановить все стартовые группы",n=document.querySelector("#buttonReturnToMainFromSettings"),n.value=n.title=o?"Return":"Возврат",document.querySelector("#tipsEN").setAttribute("class",o?"showBlock":"hiddenBlock"),document.querySelector("#tipsRU").setAttribute("class",o?"hiddenBlock":"showBlock"),document.querySelector("#hrefEMail").textContent=o?"(e-mail)":"(эл.почта)",document.querySelector("#hrefVideo").textContent=" "+(o?"(Video-Help)":"(Видео-Демо)")}document.getElementById("modalDialogHide").onclick=()=>z.close(),document.querySelector("#group").onchange=()=>function(){const e=document.getElementById("group");let t=v.find((t=>t.name===e.value));t&&(T=t.name,Ae(t.lichessPlayerNames),ke(t.chessComPlayerNames)),se()}(),document.querySelector("#langSelect").onchange=()=>Ge(),document.querySelector("#buttonPostRegistration").onclick=()=>{!async function(){const e=V();if(!e)return;K("User registration...");const t=await fetch("/registrationAJAX",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"},body:e});if(t.ok){const e=await t.json();if(Ee("jsonObj: "+new Date),Ee(e),e.errorMsg){let t=e.errorMsg.message;return void(t?Y(`Registration error: ${t}`):(t=e.errorMsg,Y(t?`Reg.error: ${t}`:"Registration unknown error")))}K("User registered.");const s=e.usernameAfterRegistration;return s?(alert("User <"+s+"> registered."),void W()):void Y("Impossible to login after registration (username is empty).")}Y("Error occured during registration.")}()},document.querySelector("#buttonPostLogin").onclick=()=>{W()},document.querySelector("#buttonPostLogout").onclick=()=>{!async function(){K(`${O} logout...`);const e=await fetch("/logoutAJAX");if(e.ok){const t=(await e.json()).msg;return K(`${O} logged out. (${t})`),Q("",""),localStorage.setItem("username",""),localStorage.setItem("regtype",""),void pe()}Y("Error occured during logout.")}()},document.addEventListener("keydown",(function(e){"Enter"!==e.key&&13!==e.keyCode||se()})),E(),function(){let n;n=localStorage.getItem("Lang"),s=n&&""!==n&&n!==e?t:e,document.getElementById("langSelect").value=s,Ge(),n=localStorage.getItem("currentGroupName"),n||(n=T),""!==n&&(T=n),n=localStorage.getItem("groupObjs"),n&&""!==n&&"undefined"!==n?(v=JSON.parse(n),L=X(),n=localStorage.getItem("LichessOrgPlayerNames"),Ae(n),n=localStorage.getItem("ChessComPlayerNames"),ke(n)):(n=localStorage.getItem("LichessOrgPlayerNames"),n||(n=S[0].lichessPlayerNames),""!==n&&Ae(n),n=localStorage.getItem("ChessComPlayerNames"),n||(n=S[0].chessComPlayerNames),""!==n&&ke(n)),n=localStorage.getItem("LichessChecked"),n=null===n?"1":n,Be("1"===n),n=localStorage.getItem("ChessComChecked"),n=null===n?"1":n,$e("1"===n),n=localStorage.getItem("isFirstChessCom"),q="1"===n,n=localStorage.getItem("AutoRefreshInterval"),we(n),n=localStorage.getItem("DarkThemeChecked"),Te("1"===n)}(),H(T),F(T),q&&ve(),be(),Me(),window.addEventListener("orientationchange",(function(){window.orientation}),!1),P=!0,function(){const e=new URLSearchParams(window.location.search);let t,s,n,o,r,l,i,c,m;if(s=e.get("afterSendUserSettingsToServer"),s)return t=localStorage.getItem("username"),s=localStorage.getItem("regtype"),void(t&&Q(t,s));if(m=e.get("errorMsgAfterRegistration"),m)return Q("",""),void alert("errorMsgAfterRegistration: "+m);const d=e.get("usernameAfterRegistration");if(d){const t=e.get("passwordAfterRegistration");t?(alert("User <"+d+"> registered."),function(e,t,s){let n=document.createElement("form");n.action=e,n.method="POST",n.innerHTML='<input name="username" value="'+t+'"><input name="password" value="'+s+'">',document.body.append(n),n.submit(),n.remove()}("/login",d,t)):alert("Impossible to login after registration (password is empty).")}else{if(m=e.get("errorMsgAfterLogin"),!m)return t=e.get("usernameAfterLogin"),t?(s=e.get("regtypeAfterLogin"),Q(t,s),localStorage.setItem("username",O),localStorage.setItem("regtype",R),s=e.get("LichessOrgPlayerNamesAfterLogin"),s&&(Ae(s),localStorage.setItem("LichessOrgPlayerNames",s)),n=e.get("ChessComPlayerNamesAfterLogin"),n&&(ke(n),localStorage.setItem("ChessComPlayerNames",n)),o=!1,t=e.get("isDarkThemeAfterLogin"),t&&(o="1"===t,Te(o),localStorage.setItem("DarkThemeChecked",o?"1":"0"),Me()),r=!1,t=e.get("CheckLichessAfterLogin"),t&&(r="1"===t,Be(r),localStorage.setItem("LichessChecked",r?"1":"0")),l=!1,t=e.get("CheckChessComAfterLogin"),t&&(l="1"===t,$e(l),localStorage.setItem("ChessComChecked",l?"1":"0")),i=!1,t=e.get("isFirstChessComAfterLogin"),t&&(i="1"===t,i!==q&&(q=i,ve()),localStorage.setItem("isFirstChessCom",i?"1":"0")),c=e.get("autoRefreshIntervalAfterLogin"),c&&(we(c),localStorage.setItem("AutoRefreshInterval",c)),void((s||n||o||r||l||i)&&(se(),P=!1))):(t=e.get("usernameAfterLogout"),t?(Q("",""),localStorage.setItem("username",""),void localStorage.setItem("regtype","")):(t=localStorage.getItem("username"),s=localStorage.getItem("regtype"),void(t&&(Q(t,s),s="PageAlreadyWasVisitedAtThisBrowserTab",n=sessionStorage.getItem(s),n||(sessionStorage.setItem(s,1),async function(){let e={username:O};const t=await fetch("/isUserLoggedAJAX",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e)});if(t.ok){const e=await t.json();Ee("isUserLoggedAJAX: jsonObj: "+new Date),Ee(e);const s=e.isUserLoggedAJAX;return s?void("0"===s&&(a.vueCurrentUsername=O+u)):void Ee("Error occured during afterIsUserLoggedAJAX.")}Ee("Error occured during isUserLoggedAJAX.")}())))));alert("errorMsgAfterLogin: "+m)}}(),P&&se()})();